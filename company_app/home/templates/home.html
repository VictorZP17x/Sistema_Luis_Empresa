{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Ícono del Sistema -->
    <link rel="icon" href="{% static 'assets/images/logo_white.png' %}" type="image/x-icon">
    <!-- jQuery -->
    <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'assets/bootstrap-5.3.6/css/bootstrap.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/bootstrap-5.3.6/css/bootstrap.min.css' %}" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="{% static 'assets/datatables/css/jquery.dataTables.min.css' %}" />
    <!-- Select2 CSS -->
    <link href="{% static 'assets/select2/css/select2.min.css' %}" rel="stylesheet" />
    <!-- Íconos - Feather Icons CSS -->
    <link rel="stylesheet" href="{% static 'assets/fonts/feather.css' %}">
    <!-- Template CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" id="main-style-link">
</head>

<body class="{% if show_header_search %}dashboard-page {% endif %}{% if is_cliente %}cliente{% endif %}">
    {% if is_trabajador %}
    <!-- NAVBAR SUPERIOR SOLO PARA TRABAJADOR -->
    <nav class="navbar navbar-expand-lg bg-primary shadow" style="position:sticky;top:0;z-index:1040;">
        <div class="container-fluid">
            <!-- Logo -->
            <a class="navbar-brand d-flex align-items-center" href="{% url 'works_to_do:works_to_do' %}">
                <img src="{% static 'assets/images/logo.png' %}" alt="Logo"
                    style="width: 60px; height: 60px; object-fit: contain; border-radius: 12px; box-shadow: 0 2px 8px #0002;">
            </a>
            <!-- Botón de menú para móvil -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTrabajador"
                aria-controls="navbarTrabajador" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Opciones -->
            <div class="collapse navbar-collapse" id="navbarTrabajador">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="{% url 'home:works_to_do' %}">
                            <i data-feather="file-text" class="me-1"></i>
                            Solicitudes de Trabajos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="{% url 'home:work_plan' %}">
                            <i data-feather="layout" class="me-1"></i>
                            Planes de Trabajo
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white d-flex align-items-center" href="#"
                            id="navbarProfile" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{% if request.user.userprofile.photo %}{{ request.user.userprofile.photo.url }}{% else %}{% static 'assets/images/user/avatar-2.jpg' %}{% endif %}"
                                alt="user-image" class="rounded-circle me-2" width="32" height="32">
                            {{ request.user.first_name }} {{ request.user.last_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="{% url 'personal_data:personal_data' %}">
                                    <i data-feather="settings" class="me-2"></i> Editar Datos Personales
                                </a>
                            </li>
                            <li>
                                <form action="{% url 'home:logout' %}" method="post" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item">
                                        <i data-feather="log-out" class="me-2"></i> Cerrar Sesión
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <style>
        .bg-primary {
            background: linear-gradient(135deg, #2e3c8c 0%, #1e2746 100%) !important;
        }
    </style>
    <script>
        if (window.feather) feather.replace();
    </script>
    {% else %}
    <!-- Sidebar y header normales para otros roles -->
    <header class="pc-header">
        <div class="header-wrapper">
            <!-- Ocultar/Mostrar Menú y Buscador -->
            <div class="me-auto pc-mob-drp">
                <ul class="list-unstyled">
                    <li class="pc-h-item pc-sidebar-collapse">
                        <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
                            <i data-feather="menu"></i>
                        </a>
                    </li>
                    <li class="pc-h-item pc-sidebar-popup">
                        <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
                            <i data-feather="menu"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- Perfil -->
            <div class="ms-auto">
                <ul class="list-unstyled">
                    <li class="dropdown pc-h-item header-user-profile">
                        <a class="pc-head-link dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#"
                            role="button" aria-haspopup="false" data-bs-auto-close="outside" aria-expanded="false">
                            <i data-feather="user"></i>
                        </a>
                        <div
                            class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown p-0 overflow-hidden">
                            <div class="dropdown-header d-flex align-items-center justify-content-between bg-primary">
                                <div class="d-flex my-2">
                                    <div class="flex-shrink-0">
                                        <img src="{% if request.user.userprofile.photo %}{{ request.user.userprofile.photo.url }}{% else %}{% static 'assets/images/user/avatar-2.jpg' %}{% endif %}"
                                            alt="user-image" class="user-avtar wid-40 rounded-circle"
                                            style="object-fit: cover;" />
                                    </div>
                                    <div class="ms-2">
                                        <span class="fw-bold text-white">{{ request.user.first_name }}
                                            {{request.user.last_name }}</span>
                                        <br>
                                        <small class="text-white-50">{{ request.user.username }}</small>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-body">
                                <div class="profile-notification-scroll position-relative"
                                    style="max-height: calc(100vh - 225px)">
                                    <a href="{% url 'personal_data:personal_data' %}" class="dropdown-item">
                                        <span>
                                            <i data-feather="settings" class="text-muted me-2"></i>
                                            <span>Cambiar Datos Personales</span>
                                        </span>
                                    </a>
                                    <div class="d-grid my-2">
                                        <form action="{% url 'home:logout' %}" method="post" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-primary">
                                                <i data-feather="log-out" class="me-2"></i>
                                                Cerrar Sesión
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Sidebar -->

    <nav class="pc-sidebar">
        <div class="navbar-wrapper">
            <div class="m-header d-flex align-items-center justify-content-center my-4">
                <a class="navbar-brand d-flex align-items-center" href="{% url 'works_to_do:works_to_do' %}">
                    <img src="{% static 'assets/images/logo.png' %}" alt="Logo"
                        style="width: 60px; height: 60px; object-fit: contain; border-radius: 12px; box-shadow: 0 2px 8px #0002;">
                </a>
            </div>
            <div class="navbar-content">
                <ul class="pc-navbar" style="align-items: flex-start;">
                    {% if is_trabajador %}
                    <li class="pc-item">
                        <a href="{% url 'home:works_to_do' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="file-text"></i></span>
                            <span class="pc-mtext">Solicitudes de Trabajos</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="{% url 'home:work_plan' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="layout"></i></span>
                            <span class="pc-mtext">Planes de Trabajo</span>
                        </a>
                    </li>
                    {% else %}
                    <!-- Para admin, empleados, clientes: TODO el menú, incluyendo estos dos -->
                    <li class="pc-item pc-hasmenu">
                        <a href="{% url 'home:dashboard' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="grid"></i></span>
                            <span class="pc-mtext">Inicio</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="{% url 'home:works_to_do' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="file-text"></i></span>
                            <span class="pc-mtext">Solicitudes de Trabajos</span>
                        </a>
                    </li>
                    <li class="pc-item pc-hasmenu">
                        <a href="{% url 'home:work_plan' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="layout"></i></span>
                            <span class="pc-mtext">Planes de Trabajo</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="{% url 'home:work_type' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="clipboard"></i></span>
                            <span class="pc-mtext">Servicios</span>
                        </a>
                    </li>
                    {% if not is_cliente %}
                    <li class="pc-item pc-hasmenu">
                        <a href="{% url 'home:company' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="briefcase"></i></span>
                            <span class="pc-mtext">Empresas</span>
                        </a>
                    </li>
                    {% if not is_empleado %}
                    <li class="pc-item">
                        <a href="{% url 'home:client' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="user"></i></span>
                            <span class="pc-mtext">Clientes</span>
                        </a>
                    </li>
                    <li class="pc-item pc-hasmenu">
                        <a href="{% url 'home:workers' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="briefcase"></i></span>
                            <span class="pc-mtext">Trabajadores</span>
                        </a>
                    </li>
                    <li class="pc-item pc-hasmenu">
                        <a href="{% url 'home:user' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="users"></i></span>
                            <span class="pc-mtext">Usuarios</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="{% url 'home:log_history' %}" class="pc-link">
                            <span class="pc-micon"><i data-feather="list"></i></span>
                            <span class="pc-mtext">Historial</span>
                        </a>
                    </li>
                    {% endif %}
                    {% endif %}
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    {% endif %}
    <main id="main-content">
        {% block content %}

        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="pc-footer">
        <div class="footer-wrapper container-fluid">
            <div class="row">
                <div class="col my-1">
                    <p class="m-0">
                        &copy; OLTEC. Todos los derechos reservados.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap JS -->
    <script src="{% static 'assets/bootstrap-5.3.6/js/bootstrap.bundle.min.js' %}"></script>
    <!-- DataTables JS -->
    <script src="{% static 'assets/datatables/js/jquery.dataTables.min.js' %}"></script>
    <!-- SweetAlert -->
    <script src="{% static 'assets/js/sweetalert2@11.js' %}"></script>
    <!-- Select2 JS -->
    <script src="{% static 'assets/select2/js/select2.min.js' %}"></script>
    <!-- Manejo de Toggle y Clases para el Contenido -->
    <script src="{% static 'assets/js/pcoded.js' %}"></script>
    <!-- Íconos - Feather Icons JS -->
    <script src="{% static 'assets/js/plugins/feather.min.js' %}"></script>
    <!-- Plugin para Customizar Scrollbars -->
    <script src="{% static 'assets/js/plugins/simplebar.min.js' %}"></script>
    <!-- CUSTOM JS -->
    {% if show_welcome %}
    <script src="{% static 'assets/js/home_js/welcome-alert.js' %}"></script>
    {% endif %}
    <script src="{% static 'assets/js/slide_bar.js' %}"></script>
    <script src="{% static 'assets/js/home_js/description-char-counter.js' %}"></script>

    {% block extra_css %}
    {% if is_trabajador %}
    <style>
        /* Ajusta el contenido para ocupar toda la pantalla cuando hay navbar */
        .pc-container,
        .pc-content,
        .pc-content>.row,
        .pc-content>.row>.col-md-12,
        .pc-content>.row>.col {
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        .card.custom-card-height,
        .card {
            margin-left: 0 !important;
            margin-right: 0 !important;
        }

        .pc-container,
        .pc-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 80vh;
        }
    </style>
    {% endif %}
    {% endblock %}

    {% block extra_js %}

    {% endblock %}
</body>

</html>